<html>
  <head>
    <title>Diagnostics diff: tests/infos/SmartCasts.kt</title>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js" integrity="sha512-XKa9Hemdy1Ui3KSGgJdgMyYlUg1gM+QhL6cnlyTe2qzMCYm4nAZ1PsVerQzTTXzonUR+dmswHqgJPuwCq1MaAg==" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css" integrity="sha512-P5MgMn1jBN01asBgU0z60Qk4QxiXo86+wlFahKrsQf37c9cro517WzVSPPV1tDKzhku2iJ2FVgL67wG03SGnNA==" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/github.min.css" integrity="sha512-7QTQ5Qsc/IL1k8UU2bkNFjpKTfwnvGuPYE6fzm6yeneWTEGiA3zspgjcTsSgln9m0cn3MgyE7EnDNkF1bB/uCw==" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html@3.4.3/bundles/css/diff2html.min.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/diff2html@3.4.3/bundles/js/diff2html-ui.min.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <div class="container-fluid">
      <div class="card-header p-0" id="heading0"><button class="btn btn-link btn-block text-left" data-toggle="collapse" data-target="#collapse0">
          <h5>Diff between FE 1.0 vs FIR</h5>
        </button></div>
      <div class="collapse show" id="collapse0">
        <div class="card-body p-1">
          <div id="diff0" style="width: 100%"></div>
        </div>
      </div>
      <script type="text/javascript">                (function() {
                    const diffString = `--- tests/infos/SmartCasts.kt
+++ tests/infos/SmartCasts.fir.kt
@@ -1,227 +1,227 @@
 open class A() {
   fun foo() {}
 }
 
 class B() : A() {
   fun bar() {}
 }
 
 fun f9(init : A?) {
   val a : A? = init
   a?.foo()
   a?.<!UNRESOLVED_REFERENCE!>bar<!>()
   if (a is B) {
-    <!DEBUG_INFO_SMARTCAST!>a<!>.bar()
-    <!DEBUG_INFO_SMARTCAST!>a<!>.foo()
+    a.bar()
+    a.foo()
   }
   a?.foo()
   a?.<!UNRESOLVED_REFERENCE!>bar<!>()
   if (!(a is B)) {
     a?.<!UNRESOLVED_REFERENCE!>bar<!>()
     a?.foo()
   }
-  if (!(a is B) || <!DEBUG_INFO_SMARTCAST!>a<!>.bar() == Unit) {
+  if (!(a is B) || a.bar() == Unit) {
       a?.<!UNRESOLVED_REFERENCE!>bar<!>()
   }
   if (!(a is B)) {
     return;
   }
-  <!DEBUG_INFO_SMARTCAST!>a<!>.bar()
-  <!DEBUG_INFO_SMARTCAST!>a<!>.foo()
+  a.bar()
+  a.foo()
 }
 
 fun f10(init : A?) {
   val a : A? = init
   if (!(a is B)) {
     return;
   }
   if (!(<!USELESS_IS_CHECK!>a is B<!>)) {
     return;
   }
 }
 
 class C() : A() {
   fun bar() {
 
   }
 }
 
 fun f101(a : A?) {
     if (a is C) {
-      <!DEBUG_INFO_SMARTCAST!>a<!>.bar();
+      a.bar();
     }
 }
 
 fun f11(a : A?) {
   when (a) {
-    is B -> <!DEBUG_INFO_SMARTCAST!>a<!>.bar()
-    is A -> <!DEBUG_INFO_SMARTCAST!>a<!>.foo()
-    is Any -> <!DEBUG_INFO_SMARTCAST!>a<!>.foo()
+    is B -> a.bar()
+    is A -> a.foo()
+    is Any -> a.foo()
     <!USELESS_IS_CHECK!>is Any?<!> -> a.<!UNRESOLVED_REFERENCE!>bar<!>()
     else -> a?.foo()
   }
 }
 
 fun f12(a : A?) {
   when (a) {
-    is B -> <!DEBUG_INFO_SMARTCAST!>a<!>.bar()
-    is A -> <!DEBUG_INFO_SMARTCAST!>a<!>.foo()
-    is Any -> <!DEBUG_INFO_SMARTCAST!>a<!>.foo();
+    is B -> a.bar()
+    is A -> a.foo()
+    is Any -> a.foo();
     <!USELESS_IS_CHECK!>is Any?<!> -> a.<!UNRESOLVED_REFERENCE!>bar<!>()
-    is C -> <!DEBUG_INFO_SMARTCAST!>a<!>.bar()
+    is C -> a.bar()
     else -> a?.foo()
   }
 
   if (<!USELESS_IS_CHECK!>a is Any?<!>) {
     a?.<!UNRESOLVED_REFERENCE!>bar<!>()
   }
   if (a is B) {
-    <!DEBUG_INFO_SMARTCAST!>a<!>.foo()
-    <!DEBUG_INFO_SMARTCAST!>a<!>.bar()
+    a.foo()
+    a.bar()
   }
 }
 
 fun f13(a : A?) {
   if (a is B) {
-    <!DEBUG_INFO_SMARTCAST!>a<!>.foo()
-    <!DEBUG_INFO_SMARTCAST!>a<!>.bar()
+    a.foo()
+    a.bar()
   }
   else {
     a?.foo()
-    <!UNRESOLVED_REFERENCE!>c<!>.<!DEBUG_INFO_MISSING_UNRESOLVED!>bar<!>()
+    <!UNRESOLVED_REFERENCE!>c<!>.bar()
   }
 
   a?.foo()
   if (!(a is B)) {
     a?.foo()
-    <!UNRESOLVED_REFERENCE!>c<!>.<!DEBUG_INFO_MISSING_UNRESOLVED!>bar<!>()
+    <!UNRESOLVED_REFERENCE!>c<!>.bar()
   }
   else {
-    <!DEBUG_INFO_SMARTCAST!>a<!>.foo()
-    <!UNRESOLVED_REFERENCE!>c<!>.<!DEBUG_INFO_MISSING_UNRESOLVED!>bar<!>()
+    a.foo()
+    <!UNRESOLVED_REFERENCE!>c<!>.bar()
   }
 
   a?.foo()
-  if (a is B && <!DEBUG_INFO_SMARTCAST!>a<!>.foo() == Unit) {
-    <!DEBUG_INFO_SMARTCAST!>a<!>.foo()
-    <!DEBUG_INFO_SMARTCAST!>a<!>.bar()
+  if (a is B && a.foo() == Unit) {
+    a.foo()
+    a.bar()
   }
   else {
     a?.foo()
-    <!UNRESOLVED_REFERENCE!>c<!>.<!DEBUG_INFO_MISSING_UNRESOLVED!>bar<!>()
+    <!UNRESOLVED_REFERENCE!>c<!>.bar()
   }
 
   if (!(a is B) || !(a is C)) {
   }
   else {
   }
 
   if (!(a is B) || !(a is C)) {
   }
 
   if (!(a is B)) return
-  <!DEBUG_INFO_SMARTCAST!>a<!>.bar()
+  a.bar()
 }
 
 fun f14(a : A?) {
   while (!(a is B)) {
   }
-  <!DEBUG_INFO_SMARTCAST!>a<!>.bar()
+  a.bar()
 }
 fun f15(a : A?) {
   do {
   } while (!(a is B))
-  <!DEBUG_INFO_SMARTCAST!>a<!>.bar()
+  a.bar()
 }
 
 fun getStringLength(obj : Any) : Char? {
   if (obj !is String)
     return null
-  return <!DEBUG_INFO_SMARTCAST!>obj<!>.get(0) // no cast to String is needed
+  return obj.get(0) // no cast to String is needed
 }
 
-fun toInt(i: Int?): Int = if (i != null) <!DEBUG_INFO_SMARTCAST!>i<!> else 0
+fun toInt(i: Int?): Int = if (i != null) i else 0
 fun illegalWhenBody(a: Any): Int = <!NO_ELSE_IN_WHEN!>when<!>(a) {
-    is Int -> <!DEBUG_INFO_SMARTCAST!>a<!>
-    is String -> <!TYPE_MISMATCH!>a<!>
+    is Int -> a
+    is String -> a
 }
 fun illegalWhenBlock(a: Any): Int {
     when(a) {
-        is Int -> return <!DEBUG_INFO_SMARTCAST!>a<!>
-        is String -> return <!TYPE_MISMATCH!>a<!>
+        is Int -> return a
+        is String -> return <!RETURN_TYPE_MISMATCH!>a<!>
     }
 <!NO_RETURN_IN_FUNCTION_WITH_BLOCK_BODY!>}<!>
 fun declarations(a: Any?) {
     if (a is String) {
-       val p4: String = <!DEBUG_INFO_SMARTCAST!>a<!>
+       val p4: String = a
     }
     if (a is String?) {
         if (a != null) {
-            val s: String = <!DEBUG_INFO_SMARTCAST!>a<!>
+            val s: String = a
         }
     }
     if (a != null) {
         if (a is String?) {
-            val s: String = <!DEBUG_INFO_SMARTCAST!>a<!>
+            val s: String = a
         }
     }
 }
 fun vars(a: Any?) {
-    var <!ASSIGNED_BUT_NEVER_ACCESSED_VARIABLE!>b<!>: Int = 0
+    var b: Int = 0
     if (a is Int) {
-        b = <!DEBUG_INFO_SMARTCAST!>a<!>
+        b = a
     }
 }
 fun returnFunctionLiteralBlock(a: Any?): Function0<Int> {
-    if (a is Int) return { <!DEBUG_INFO_SMARTCAST!>a<!> }
+    if (a is Int) return { a }
     else return { 1 }
 }
 fun returnFunctionLiteral(a: Any?): Function0<Int> {
-    if (a is Int) return { -> <!DEBUG_INFO_SMARTCAST!>a<!> }
+    if (a is Int) return { -> a }
     else return { -> 1 }
 }
 
 fun returnFunctionLiteralExpressionBody(a: Any?): Function0<Int> =
-        if (a is Int) { -> <!DEBUG_INFO_SMARTCAST!>a<!> }
+        if (a is Int) { -> a }
         else { -> 1 }
 
 
 fun mergeSmartCasts(a: Any?) {
   if (a is String || a is Int) {
-    a.<!UNRESOLVED_REFERENCE!>compareTo<!>("")
-    <!DEBUG_INFO_SMARTCAST!>a<!>.toString()
+    a.compareTo(<!ARGUMENT_TYPE_MISMATCH!>""<!>)
+    a.toString()
   }
   if (a is Int || a is String) {
-    a.<!UNRESOLVED_REFERENCE!>compareTo<!>("")
+    a.compareTo(<!ARGUMENT_TYPE_MISMATCH!>""<!>)
   }
   when (a) {
     is String, is Any -> a.<!UNRESOLVED_REFERENCE!>compareTo<!>("")
   }
   if (a is String && <!USELESS_IS_CHECK!>a is Any<!>) {
-    val i: Int = <!DEBUG_INFO_SMARTCAST!>a<!>.compareTo("")
+    val i: Int = a.compareTo("")
   }
-  if (a is String && <!DEBUG_INFO_SMARTCAST!>a<!>.compareTo("") == 0) {}
-  if (a is String || a.<!UNRESOLVED_REFERENCE!>compareTo<!>("") <!DEBUG_INFO_MISSING_UNRESOLVED!>==<!> 0) {}
+  if (a is String && a.compareTo("") == 0) {}
+  if (a is String || a.<!UNRESOLVED_REFERENCE!>compareTo<!>("") == 0) {}
 }
 
 //mutability
 fun f(): String {
     var a: Any = 11
     if (a is String) {
         // a is a string, despite of being a variable
-        val i: String = <!DEBUG_INFO_SMARTCAST!>a<!>
-        <!DEBUG_INFO_SMARTCAST!>a<!>.compareTo("f")
+        val i: String = a
+        a.compareTo("f")
         // Beginning from here a is captured in a closure but nobody modifies it
-        val f: Function0<String> = { <!DEBUG_INFO_SMARTCAST!>a<!> }
-        return <!DEBUG_INFO_SMARTCAST!>a<!>
+        val f: Function0<String> = { a }
+        return a
     }
     return ""
 }
 
 fun foo(aa: Any?): Int {
     var a = aa
     if (a is Int?) {
-        return <!TYPE_MISMATCH!>a<!>
+        return <!RETURN_TYPE_MISMATCH!>a<!>
     }
     return 1
 }`;
                    const targetElement = $('#diff0')[0];
                    const configuration = {
                        drawFileList: false,
                        fileListToggle: false,
                        fileListStartVisible: false,
                        fileContentToggle: false,
                        matching: 'lines',
                        outputFormat: 'side-by-side',
                        synchronisedScroll: true,
                        highlight: true,
                        renderNothingWhenEmpty: false,
                        rawTemplates: {
                            'generic-file-path': `
                                <div class="col">
                                    <a href="https://github.com/JetBrains/kotlin/blob/4243bafd1d28dfb708235ccdeb5ac14e307f7354/compiler/testData/diagnostics/tests/infos/SmartCasts.kt" target="_blank">
                                        <strong>FE 1.0:</strong> tests/infos/SmartCasts.kt
                                    </a>
                                </div>
                                <div class="col">
                                    <a href="https://github.com/JetBrains/kotlin/blob/4243bafd1d28dfb708235ccdeb5ac14e307f7354/compiler/testData/diagnostics/tests/infos/SmartCasts.fir.kt" target="_blank">
                                        <strong>FIR:</strong> tests/infos/SmartCasts.fir.kt
                                    </a>
                                </div>
                            `
                        }
                    };
                    const diff2htmlUi = new Diff2HtmlUI(targetElement, diffString, configuration);
                    diff2htmlUi.draw();
                    diff2htmlUi.highlightCode();
                })();</script>
    </div>
  </body>
</html>
